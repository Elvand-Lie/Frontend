<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFP Store - The Full Picture</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
<style>
    /* --- CSS VARIABLES & RESET --- */
    :root { 
        --bg-dark: #050000; 
        --primary-red: #c90000; 
        --highlight-red: #ff3333;
        --text-white: #ffffff;
        --text-gray: #b0b0b0;
        --light-gray: #f4f4f4;
        --border-color: #e5e5e5;
        --transition: all 0.3s ease; 
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', Arial, sans-serif; }
    html, body { scrollbar-width: none; -ms-overflow-style: none; scroll-behavior: smooth; }
    html::-webkit-scrollbar, body::-webkit-scrollbar { display: none; }
    
    body { background-color: #ffffff; color: #333; overflow-x: hidden; }
    a { text-decoration: none; color: inherit; }
    ul { list-style: none; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

    /* --- HEADER --- */
    header {
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        padding: 20px 0;
        transition: background 0.3s;
    }

    header.scrolled {
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .nav-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
    }

    .logo, .btn-contact {
        z-index: 20; 
        position: relative;
    }

    .logo {
        width: 50px;
        height: 50px;
        background: white;
        border: 2px solid #c90000;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .logo img {
        width: 100%;       
        height: auto;     
        object-fit: contain;
        display: block;
    }

    /* --- PILL NAVIGATION & DROPDOWNS --- */
    .main-nav {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        padding: 0 40px; 
        height: 55px;
        width: max-content;
        background: rgba(20, 20, 20, 0.8); 
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 100px;
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 10;
    }

    .nav-item {
        position: relative;
        height: 100%;
        display: flex;
        align-items: center;
    }

    .nav-link {
        font-size: 1.05rem;
        color: #b0b0b0;
        padding: 0 15px;
        transition: all 0.3s ease;
        text-decoration: none;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
    }

    .nav-link i {
        font-size: 10px;
        transition: transform 0.3s ease;
    }

    .nav-item:hover .nav-link i {
        transform: rotate(180deg);
    }

    .nav-link:hover, .nav-link.active {
        color: #ffffff;
    }

    .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: 12px;
        left: 15px;
        width: calc(100% - 30px);
        height: 2px;
        background: #c90000;
        box-shadow: 0 0 10px #c90000;
    }

    /* --- DROPDOWN MENU --- */
    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(20px);
        background: white;
        border-radius: 8px;
        padding: 8px 0;
        min-width: 180px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 100;
        border: 1px solid #ddd;
    }

    .nav-item:hover .dropdown-menu {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(10px);
    }

    .dropdown-menu::before {
        content: '';
        position: absolute;
        top: -6px;
        left: 50%;
        transform: translateX(-50%) rotate(45deg);
        width: 12px;
        height: 12px;
        background: white;
        border-top: 1px solid #ddd;
        border-left: 1px solid #ddd;
    }

    .dropdown-menu li a {
        display: block;
        padding: 10px 20px;
        color: #333;
        font-size: 0.95rem;
        font-weight: 500;
        border-bottom: 1px solid #eee;
        transition: background 0.2s;
        white-space: nowrap;
    }

    .dropdown-menu li:last-child a { border-bottom: none; }

    .dropdown-menu li a:hover {
        background: #f5f5f5;
        color: var(--primary-red);
    }

    .btn-contact {
        background: #c90000;
        color: white;
        padding: 12px 30px;
        border-radius: 30px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        z-index: 20; 
        position: relative;
    }

    .btn-contact:hover {
        background: #ff0000;
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
    }

    @media (max-width: 900px) {
        .main-nav { display: none; }
    }

    /* --- HERO --- */
    .store-hero { height: 85vh; width: 100%; position: relative; overflow: hidden; display: flex; align-items: center; }
    .hero-slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; transition: opacity 1.5s ease-in-out; z-index: 1; }
    .hero-slide.active { opacity: 1; }
    .hero-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, rgba(0,0,0,0.95) 0%, rgba(20,0,0,0.6) 50%, rgba(0,0,0,0.2) 100%); z-index: 2; }
    .store-hero-content { position: relative; z-index: 5; max-width: 650px; color: white; padding-top: 60px; }
    .store-title { font-size: 5rem; line-height: 1.1; font-weight: 800; margin-bottom: 20px; background: linear-gradient(90deg, #ffffff 0%, #ffcccc 50%, #c90000 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; display: inline-block; }
    .store-subtitle { font-size: 1.1rem; line-height: 1.6; color: #ddd; margin-bottom: 40px; font-weight: 300; max-width: 500px; }
    .btn-shop-hero { display: inline-block; background: var(--primary-red); color: white; font-weight: 600; padding: 15px 40px; border-radius: 50px; font-size: 1.1rem; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .btn-shop-hero:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(200, 0, 0, 0.5); }
    .hero-dots { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 10; }
    .dot { width: 10px; height: 10px; background: rgba(255,255,255,0.3); border-radius: 50%; cursor: pointer; transition: all 0.3s; }
    .dot.active { background: #c90000; transform: scale(1.3); }

    /* --- SHOP SECTION --- */
    .shop-section { padding: 60px 0 100px; position: relative; background-color: #fff; }
    .shop-layout { display: flex; gap: 60px; align-items: flex-start; }
    
    /* --- SIDEBAR STYLING --- */
    .shop-sidebar { 
        width: 260px; 
        flex-shrink: 0; 
        position: sticky; 
        top: 100px; 
        height: fit-content;
        padding-right: 20px;
        border-right: 1px solid #f0f0f0;
    }

    .filter-group { margin-bottom: 30px; }
    .filter-title { font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: #111; margin-bottom: 15px; display: block; }
    
    /* Input Styling */
    .search-input { 
        width: 100%; padding: 12px 15px; border: 1px solid var(--border-color); 
        border-radius: 8px; background: #fafafa; font-size: 0.95rem; outline: none; transition: all 0.3s ease;
    }
    .search-input:focus { border-color: var(--primary-red); background: white; box-shadow: 0 0 0 3px rgba(201,0,0,0.1); }

    .sort-select { 
        width: 100%; padding: 10px; border: 1px solid var(--border-color); 
        border-radius: 8px; background: white; cursor: pointer; outline: none; font-size: 0.9rem;
    }
    .sort-select:focus { border-color: var(--primary-red); }

    /* Category List */
    .filter-list li { margin-bottom: 8px; }
    .filter-list li a { 
        font-size: 1rem; color: #666; display: block; padding: 6px 10px; border-radius: 6px; transition: all 0.2s; 
    }
    .filter-list li a:hover { background: #f5f5f5; color: #000; }
    .filter-list li a.active { 
        background: #fff0f0; color: var(--primary-red); font-weight: 600; border-left: 3px solid var(--primary-red);
    }

    /* Checkbox Styling */
    .filter-checkbox { 
        display: flex; align-items: center; gap: 12px; cursor: pointer; font-size: 0.95rem; 
        padding: 10px; background: #f9f9f9; border-radius: 8px; transition: 0.2s;
    }
    .filter-checkbox:hover { background: #eee; }
    .filter-checkbox input { accent-color: var(--primary-red); width: 18px; height: 18px; }

    /* Range Slider */
    .range-slider-container { margin-top: 15px; }
    .range-input { 
        width: 100%; height: 4px; background: #e5e5e5; border-radius: 5px; outline: none; -webkit-appearance: none;
    }
    .range-input::-webkit-slider-thumb {
        -webkit-appearance: none; width: 18px; height: 18px; background: var(--primary-red); border-radius: 50%; cursor: pointer; transition: transform 0.2s;
    }
    .range-input::-webkit-slider-thumb:hover { transform: scale(1.2); }
    
    .price-labels { display: flex; justify-content: space-between; font-size: 0.85rem; font-weight: 600; margin-top: 10px; color: #555; }

    /* --- GRID & CARDS --- */
    .product-grid { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; }
    
    .product-card { 
        background: white; 
        transition: transform 0.3s, box-shadow 0.3s; 
        cursor: pointer; 
        border-radius: 8px; 
        overflow: hidden;
        border: 1px solid transparent;
        position: relative; 
    }
    .product-card:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 15px 30px rgba(0,0,0,0.08); 
        border-color: #eee;
    }

    /* RIBBON STYLING */
    .ribbon { 
        display: none;
        position: absolute; top: 10px; left: 10px; 
        background: #000; color: white; 
        font-size: 0.65rem; font-weight: 700; text-transform: uppercase; 
        padding: 5px 12px; border-radius: 4px; z-index: 10; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .product-card.best-seller .ribbon {
        display: block;
    }

    .card-img-wrapper { 
        width: 100%; aspect-ratio: 4/5; background: #f9f9f9; 
        display: flex; align-items: center; justify-content: center; 
        overflow: hidden; position: relative; 
    }
    .card-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.6s ease; }
    .product-card:hover .card-img { transform: scale(1.08); }
    
    .card-info { padding: 15px 0; text-align: left; }
    .p-name { font-size: 1rem; color: #111; margin-bottom: 6px; font-weight: 500; }
    .p-price { font-size: 0.95rem; font-weight: 700; color: #555; }

    .add-to-cart-btn {
        position: absolute; bottom: 15px; right: 15px;
        background: white; color: black; border: none; 
        width: 40px; height: 40px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        opacity: 0; transform: translateY(10px);
        transition: all 0.3s ease; cursor: pointer;
    }
    .product-card:hover .add-to-cart-btn { opacity: 1; transform: translateY(0); }
    .add-to-cart-btn:hover { background: var(--primary-red); color: white; }

    /* --- FLOATING CHECKOUT BAR --- */
    #checkout-bar {
        position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(120px);
        background: #111; color: white; padding: 12px 25px; border-radius: 50px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.3); z-index: 1000;
        display: flex; align-items: center; gap: 20px; transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        min-width: 300px; justify-content: space-between;
        cursor: pointer;
    }
    #checkout-bar.active { transform: translateX(-50%) translateY(0); }
    #checkout-bar:hover { transform: translateX(-50%) translateY(-5px); }

    .checkout-btn {
        background: var(--primary-red); border: none; color: white; padding: 10px 25px;
        border-radius: 25px; font-weight: 600; cursor: pointer; transition: background 0.3s;
    }
    .checkout-btn:hover { background: #ff3333; }

    /* --- CART DRAWER & OVERLAY --- */
    .cart-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.6); z-index: 2000;
        opacity: 0; visibility: hidden; transition: all 0.3s ease;
        backdrop-filter: blur(2px);
    }
    .cart-overlay.open { opacity: 1; visibility: visible; }

    .cart-drawer {
        position: fixed; top: 0; right: 0; width: 100%; max-width: 450px; height: 100%;
        background: white; z-index: 2001;
        transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        display: flex; flex-direction: column;
        box-shadow: -10px 0 40px rgba(0,0,0,0.2);
    }
    .cart-drawer.open { transform: translateX(0); }

    .cart-header {
        padding: 20px 25px; border-bottom: 1px solid #eee;
        display: flex; justify-content: space-between; align-items: center;
        background: #fff;
    }
    .cart-header h3 { font-size: 1.2rem; font-weight: 800; color: #111; }
    .close-cart-btn {
        background: none; border: none; font-size: 1.5rem; cursor: pointer;
        color: #999; transition: 0.2s;
    }
    .close-cart-btn:hover { color: var(--primary-red); transform: rotate(90deg); }

    .cart-items-container { flex: 1; overflow-y: auto; padding: 25px; }
    
    .cart-item {
        display: flex; gap: 15px; margin-bottom: 25px;
        padding-bottom: 25px; border-bottom: 1px solid #f5f5f5;
        animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .cart-item img {
        width: 80px; height: 80px; object-fit: cover; border-radius: 8px;
        background: #f9f9f9;
    }
    
    .cart-item-details { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
    .cart-item-title { font-weight: 600; font-size: 1rem; color: #111; line-height: 1.3; }
    .cart-item-price { color: #666; font-size: 0.9rem; font-weight: 500; margin-top: 5px; }

    .qty-controls {
        display: flex; align-items: center; gap: 15px;
        background: #f4f4f4; width: fit-content; padding: 5px 15px;
        border-radius: 50px; margin-top: 10px;
    }
    .qty-btn {
        border: none; background: none; cursor: pointer; font-size: 1rem;
        font-weight: 600; color: #555; transition: 0.2s;
        width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
    }
    .qty-btn:hover { color: var(--primary-red); transform: scale(1.2); }
    .qty-display { font-weight: 700; font-size: 0.95rem; min-width: 20px; text-align: center; }

    .cart-footer { padding: 30px; border-top: 1px solid #eee; background: #fff; }
    
    .cart-summary-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; color: #666; }
    .cart-total-row { display: flex; justify-content: space-between; margin-top: 15px; margin-bottom: 25px; font-size: 1.3rem; font-weight: 800; color: #111; border-top: 1px dashed #ddd; padding-top: 15px; }

    .btn-checkout-full {
        width: 100%; background: var(--primary-red); color: white;
        padding: 16px; border: none; border-radius: 50px;
        font-weight: 600; font-size: 1.05rem; cursor: pointer;
        transition: all 0.3s ease; box-shadow: 0 10px 20px rgba(201,0,0,0.2);
        display: flex; justify-content: center; align-items: center; gap: 10px;
    }
    .btn-checkout-full:hover { background: #ff0000; transform: translateY(-3px); box-shadow: 0 15px 30px rgba(255,0,0,0.3); }

    .empty-cart-msg { text-align: center; color: #999; margin-top: 50px; }
    .empty-cart-msg i { font-size: 3rem; margin-bottom: 15px; color: #eee; }

    /* --- FOOTER --- */
    footer { background-color: #400000; background-image: linear-gradient(180deg, #2b0000 0%, #400000 100%); padding-top: 80px; color: white; margin-top: 0; }
    .footer-grid { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 50px; margin-bottom: 50px; }
    .footer-col h4 { color: white; margin-bottom: 25px; font-size: 1.1rem; text-transform: uppercase; font-weight: 700; }
    .footer-col p, .footer-col li { color: #ffd1d1; margin-bottom: 12px; font-size: 0.95rem; line-height: 1.7; }
    .social-icons { display: flex; gap: 15px; margin-top: 20px; }
    .social-icon { width: 40px; height: 40px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; border-radius: 8px; color: white; transition: var(--transition); }
    .social-icon:hover { background: white; color: var(--primary-red); }
    .copyright { background-color: #c90000; background-image: linear-gradient(to right, #2b0000, #c90000, #2b0000); color: white; text-align: center; padding: 20px 0; font-size: 0.85rem; width: 100vw; position: relative; left: 50%; margin-left: -50vw; }

    @media (max-width: 1024px) { .product-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 900px) { .main-nav { display: none; } .store-title { font-size: 3.5rem; } }
    @media (max-width: 768px) { .shop-layout { flex-direction: column; } .shop-sidebar { width: 100%; position: relative; top: 0; border-right: none; margin-bottom: 40px; border-bottom: 1px solid #eee; padding-bottom: 20px; } .product-grid { grid-template-columns: repeat(2, 1fr); } }
</style>
</head>
<body>

    <header id="header">
        <div class="container nav-wrapper">
            <div class="logo">
                <img src="image.svg" alt="Logo">
            </div>
            
            <nav class="main-nav">
                <div class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </div>

                <div class="nav-item">
                    <span class="nav-link">About <i class="fas fa-chevron-down"></i></span>
                    <ul class="dropdown-menu">
                        <li><a href="aboutus.html">About Us</a></li>
                        <li><a href="trainer.html">About The Trainer</a></li>
                        <li><a href="MissionVision.html">Mission & Vision</a></li>
                    </ul>
                </div>

                <div class="nav-item">
                    <span class="nav-link active">Programs <i class="fas fa-chevron-down"></i></span>
                    <ul class="dropdown-menu">
                        <li><a href="programlist.html">Program List</a></li>
                        <li><a href="shop.html">Training Programs</a></li>
                        <li><a href="contact.html">Book Online</a></li>
                        <li><a href="shop2.html">Store</a></li>
                    </ul>
                </div>

                <div class="nav-item">
                    <span class="nav-link">Events <i class="fas fa-chevron-down"></i></span>
                    <ul class="dropdown-menu">
                        <li><a href="pastEvents.html">Past Events</a></li>
                        <li><a href="upcomingEvents.html">Upcoming Events</a></li>
                        <li><a href="blog.html">Blog</a></li>
                    </ul>
                </div>

                <div class="nav-item">
                    <a href="pastEvents.html" class="nav-link">Projects</a>
                </div>
                <div class="nav-item">
                    <a href="notifications.html" class="nav-link">Notifications</a>
                </div>
            </nav>

            <a href="contact.html" class="btn-contact">Contact Us</a>
        </div>
    </header>

    <section class="store-hero">
        <div class="hero-slide active" style="background-image: url('https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=2070&auto=format&fit=crop');"></div>
        <div class="hero-slide" style="background-image: url('store/pexels-kish-1488463.jpg');"></div>
        <div class="hero-slide" style="background-image: url('https://images.unsplash.com/photo-1441984904996-e0b6ba687e04?q=80&w=2070&auto=format&fit=crop');"></div>
        <div class="hero-overlay"></div>
        <div class="container" style="z-index: 5; position: relative; width: 100%;">
            <div class="store-hero-content">
                <h1 class="store-title">TFP Store</h1>
                <p class="store-subtitle">Selected products of the highest quality, designed for your comfort, beauty, and confidence.</p>
                <a href="#grid" class="btn-shop-hero">Shop Now</a>
            </div>
        </div>
        <div class="hero-dots">
            <div class="dot active" onclick="manualSlide(0)"></div>
            <div class="dot" onclick="manualSlide(1)"></div>
            <div class="dot" onclick="manualSlide(2)"></div>
        </div>
    </section>

    <section class="shop-section">
        <div class="container">
            <div class="breadcrumb" style="margin-bottom: 40px; font-weight: 500; color: #777;">Home / <span style="color: #000; font-weight: 700;">All Products</span></div>
            
            <div class="shop-layout">
                
                <aside class="shop-sidebar">
                    <div class="filter-group">
                        <span class="filter-title">Search</span>
                        <input type="text" id="search-input" class="search-input" placeholder="Search products..." onkeyup="handleFilterChange()">
                    </div>

                    <div class="filter-group">
                        <span class="filter-title">Categories</span>
                        <ul class="filter-list" id="category-list">
                            <li><a href="#" onclick="setCategory('All')" class="active">All Products</a></li>
                        </ul>
                    </div>

                    <div class="filter-group">
                        <span class="filter-title">Filter & Sort</span>
                        
                        <div style="margin-top: 15px;">
                            <label class="filter-checkbox">
                                <input type="checkbox" id="best-seller-check" onchange="handleFilterChange()"> 
                                Best Sellers Only
                            </label>

                            <select id="sort-select" class="sort-select" onchange="handleFilterChange()" style="margin-top: 15px;">
                                <option value="default">Sort by: Recommended</option>
                                <option value="price-asc">Price: Low to High</option>
                                <option value="price-desc">Price: High to Low</option>
                                <option value="name-asc">Name: A to Z</option>
                            </select>

                            <div style="margin-top: 25px;">
                                <span class="filter-title" style="margin-bottom: 8px;">Max Price</span>
                                <div class="range-slider-container">
                                    <input type="range" id="price-range" class="range-input" min="0" max="1000" step="10" value="1000" oninput="updatePriceLabel(this.value)" onchange="handleFilterChange()">
                                    <div class="price-labels">
                                        <span>$0</span>
                                        <span id="price-val-label">$1000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>

                <div class="product-grid" id="grid">
                    <div style="grid-column: 1/-1; text-align: center; padding: 50px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #c90000;"></i>
                        <p style="margin-top: 10px;">Loading Products...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="checkout-bar">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-shopping-bag" style="color: #888;"></i>
            <div>
                <span style="color: #999; font-size: 0.8rem;">Cart Total</span>
                <div id="cart-count" style="font-weight: 700; font-size: 1.1rem; line-height: 1;">0 Items</div>
            </div>
        </div>
        <button class="checkout-btn" onclick="toggleCart(true)">View Cart <i class="fas fa-arrow-up" style="margin-left: 5px;"></i></button>
    </div>

    <div class="cart-overlay" id="cart-overlay" onclick="toggleCart(false)"></div>
    <div class="cart-drawer" id="cart-drawer">
        <div class="cart-header">
            <h3>Your Shopping Bag</h3>
            <button class="close-cart-btn" onclick="toggleCart(false)">&times;</button>
        </div>
        
        <div class="cart-items-container" id="cart-items-container">
            </div>

        <div class="cart-footer">
            <div class="cart-total-row">
                <span>Total</span>
                <span id="cart-total-price">$0.00</span>
            </div>
            <button class="btn-checkout-full" onclick="checkout()">
                Proceed to Checkout <i class="fas fa-lock"></i>
            </button>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>The Full Picture LLP</h4>
                    <p>Combining Ancient Wisdom and Modern Business Strategy.</p>
                    <br><p>Location: Singapore</p>
                </div>
                <div class="footer-col">
                    <h4>Explore</h4>
                    <ul>
                        <li><a href="programlist.html">Services</a></li>
                        <li><a href="trainer.html">About Jose He</a></li>
                        <li><a href="success.html">Success Stories</a></li>
                        <li><a href="contact.html">Book Consultation</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Chat with us</h4>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                         <i class="fab fa-whatsapp" style="font-size: 24px; color: #25D366;"></i>
                         <i class="far fa-envelope" style="font-size: 24px; color: #007bff;"></i>
                    </div>
                    <h4>Follow Us</h4>
                    <div class="social-icons">
                        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <div class="copyright">Copyright © 2026 The Full Picture. All rights reserved.</div>
        </div>
    </footer>

    <script>
        // --- 1. CONFIGURATION ---
        const SUPABASE_URL = 'https://rfagyatoxrkwuccglvym.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmYWd5YXRveHJrd3VjY2dsdnltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MDA2NTQsImV4cCI6MjA4NDI3NjY1NH0.y2mPnqqtyKc-3KZ58-65bKYg1wtYbxSnnzfBl_LYaXY';
        const GO_BACKEND_URL = 'http://localhost:8080/create-checkout-session';

        const sbClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let cart = []; // Stores objects like { id: "123", qty: 2 }
        let allProducts = [];
        let currentCategory = 'All';

        // --- 2. FETCH PRODUCTS ---
        async function fetchProducts() {
            const { data, error } = await sbClient.from('products').select('*');
            const grid = document.getElementById('grid');
            
            if (error || !data || data.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center;"><p>Error loading products.</p></div>';
                return;
            }

            allProducts = data;
            generateCategorySidebar(data);
            determineMaxPrice(data);
            renderFilteredProducts();
        }

        // --- 3. UI RENDER LOGIC (GRID) ---
        function generateCategorySidebar(products) {
            const categoryList = document.getElementById('category-list');
            const categories = [...new Set(products.map(p => p.category))].filter(Boolean);
            categoryList.innerHTML = '<li><a href="#" onclick="setCategory(\'All\')" class="active" id="cat-btn-All">All Products</a></li>';
            categories.forEach(cat => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="#" onclick="setCategory('${cat}')" id="cat-btn-${cat}">${cat}</a>`;
                categoryList.appendChild(li);
            });
        }

        function setCategory(cat) {
            event.preventDefault();
            currentCategory = cat;
            document.querySelectorAll('.filter-list a').forEach(el => el.classList.remove('active'));
            document.getElementById(`cat-btn-${cat}`).classList.add('active');
            renderFilteredProducts();
        }

        function determineMaxPrice(products) {
            const maxPrice = Math.max(...products.map(p => parseFloat(p.price)));
            const slider = document.getElementById('price-range');
            slider.max = Math.ceil(maxPrice) + 50;
            slider.value = slider.max;
            updatePriceLabel(slider.value);
        }

        function updatePriceLabel(val) {
            document.getElementById('price-val-label').innerText = '$' + val;
        }

        function handleFilterChange() { renderFilteredProducts(); }

        function renderFilteredProducts() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const onlyBestSeller = document.getElementById('best-seller-check').checked;
            const sortValue = document.getElementById('sort-select').value;
            const maxPrice = parseFloat(document.getElementById('price-range').value);

            let filtered = allProducts.filter(product => {
                const price = parseFloat(product.price);
                const isBestSeller = String(product.is_best_seller) === 'true';
                return product.name.toLowerCase().includes(searchText) &&
                       (currentCategory === 'All' || product.category === currentCategory) &&
                       price <= maxPrice &&
                       (!onlyBestSeller || isBestSeller);
            });

            if (sortValue === 'price-asc') filtered.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
            else if (sortValue === 'price-desc') filtered.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
            else if (sortValue === 'name-asc') filtered.sort((a, b) => a.name.localeCompare(b.name));

            if (filtered.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #888;"><h3>No items found</h3></div>';
                return;
            }

            filtered.forEach(product => {
                const isBestSeller = String(product.is_best_seller) === 'true';
                const priceNum = parseFloat(product.price);
                const formattedPrice = new Intl.NumberFormat('en-SG', { style: 'currency', currency: 'SGD' }).format(priceNum);

                const card = document.createElement('div');
                card.className = isBestSeller ? 'product-card best-seller' : 'product-card';
                card.innerHTML = `
                    <div class="card-img-wrapper">
                        <div class="ribbon">Best Seller</div>
                        <img src="${product.image_url}" class="card-img" alt="${product.name}" onerror="this.src='https://placehold.co/300x400?text=No+Image'">
                        <button class="add-to-cart-btn" onclick="addToCart('${product.id}')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="card-info">
                        <div class="p-name">${product.name}</div>
                        <div class="p-price">${formattedPrice}</div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- 4. CART LOGIC (UPDATED) ---
        
        // Add item to cart
        function addToCart(productId) {
            // Prevent event bubbling if clicking button inside card
            if(event) event.stopPropagation();

            const existing = cart.find(item => item.id === productId);
            if (existing) {
                existing.qty++;
            } else {
                cart.push({ id: productId, qty: 1 });
            }
            updateCartUI();
            toggleCart(true); // Open cart automatically when adding
        }

        // Update quantity (+ or -)
        function updateItemQty(productId, change) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                cart[itemIndex].qty += change;
                
                // Remove if qty is 0 or less
                if (cart[itemIndex].qty <= 0) {
                    cart.splice(itemIndex, 1);
                }
            }
            updateCartUI();
        }

        // Render the Cart UI (Drawer & Bar)
        function updateCartUI() {
            const container = document.getElementById('cart-items-container');
            const countLabel = document.getElementById('cart-count');
            const priceLabel = document.getElementById('cart-total-price');
            const checkoutBar = document.getElementById('checkout-bar');
            
            container.innerHTML = '';
            let totalQty = 0;
            let totalPrice = 0;

            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart-msg">
                        <i class="fas fa-shopping-basket"></i>
                        <p>Your bag is empty.</p>
                    </div>`;
            } else {
                cart.forEach(cartItem => {
                    const product = allProducts.find(p => p.id === cartItem.id);
                    if (!product) return;

                    totalQty += cartItem.qty;
                    totalPrice += parseFloat(product.price) * cartItem.qty;

                    const formattedPrice = new Intl.NumberFormat('en-SG', { style: 'currency', currency: 'SGD' }).format(parseFloat(product.price));

                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'cart-item';
                    itemDiv.innerHTML = `
                        <img src="${product.image_url}" alt="${product.name}" onerror="this.src='https://placehold.co/100?text=No+Img'">
                        <div class="cart-item-details">
                            <div>
                                <div class="cart-item-title">${product.name}</div>
                                <div class="cart-item-price">${formattedPrice}</div>
                            </div>
                            <div class="qty-controls">
                                <button class="qty-btn" onclick="updateItemQty('${cartItem.id}', -1)">−</button>
                                <span class="qty-display">${cartItem.qty}</span>
                                <button class="qty-btn" onclick="updateItemQty('${cartItem.id}', 1)">+</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(itemDiv);
                });
            }

            // Update totals
            countLabel.innerText = totalQty + (totalQty === 1 ? ' Item' : ' Items');
            priceLabel.innerText = new Intl.NumberFormat('en-SG', { style: 'currency', currency: 'SGD' }).format(totalPrice);

            // Show/Hide Floating Bar based on cart status
            if (totalQty > 0) {
                checkoutBar.classList.add('active');
                // Change button text in float bar to "View Cart"
                checkoutBar.querySelector('.checkout-btn').innerHTML = 'View Cart <i class="fas fa-arrow-up"></i>';
                // Only toggle if clicking the bar itself (prevent if clicking inside)
                checkoutBar.onclick = function() { toggleCart(true); };
            } else {
                checkoutBar.classList.remove('active');
            }
        }

        // Toggle Drawer Open/Close
        function toggleCart(isOpen) {
            const overlay = document.getElementById('cart-overlay');
            const drawer = document.getElementById('cart-drawer');
            
            if (isOpen) {
                overlay.classList.add('open');
                drawer.classList.add('open');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            } else {
                overlay.classList.remove('open');
                drawer.classList.remove('open');
                document.body.style.overflow = '';
            }
        }

        // --- 5. CHECKOUT ---
        async function checkout() {
            if (cart.length === 0) return;
            const btn = document.querySelector('.btn-checkout-full');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

            try {
                const response = await fetch(GO_BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ items: cart })
                });
                const result = await response.json();
                if (result.url) {
                    window.location.href = result.url;
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                    btn.innerHTML = originalText;
                }
            } catch (err) {
                console.error(err);
                alert('Failed to connect to checkout server.');
                btn.innerHTML = originalText;
            }
        }

        // --- 6. INITIALIZATION ---
        window.addEventListener('scroll', function() {
            const header = document.getElementById('header');
            if (window.scrollY > 50) header.classList.add('scrolled');
            else header.classList.remove('scrolled');
        });

        let currentSlide = 0;
        const slides = document.querySelectorAll('.hero-slide');
        const dots = document.querySelectorAll('.dot');
        function showSlide(index) {
            if(slides.length === 0) return;
            slides.forEach(s => s.classList.remove('active'));
            dots.forEach(d => d.classList.remove('active'));
            slides[index].classList.add('active');
            dots[index].classList.add('active');
            currentSlide = index;
        }
        function nextSlide() { showSlide((currentSlide + 1) % slides.length); }
        if(slides.length > 0) setInterval(nextSlide, 5000);

        fetchProducts(); 
    </script>
</body>
</html>